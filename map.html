<!DOCTYPE HTML>
<html>
    <head>
        <meta name="viewport" content="width=device-width, target-densitydpi=medium-dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <!-- Load map api -->
        <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBxiWnrLHLqqaKtyg6-S0qvOquvcrwRJHM&sensor=true"></script>

        <!-- Load standard libraries -->
        <script src="js/libs/cordova-2.1.0.js"></script>
        <script src="js/libs/underscore-min.js"></script>
        <script src="js/libs/jquery-1.8.2.min.js"></script>
        <script src="js/libs/dust-full-0.3.0.js"></script>

        <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css" />
        <script src="bootstrap/js/bootstrap.min.js"></script>

        <!-- Load plugins -->
        <script src="js/libs/webintent.js"></script>
        <script src="js/libs/actionbar.js"></script>
        <script src="js/libs/camera.js"></script>

        <!-- Load custom libraries -->
        <script src="js/libs/zeptotouch.js"></script>

        <!-- Load application files -->
        <link rel="stylesheet" type="text/css" href="css/mwater.css" />

        <script src="js/i18n.js"></script>
        <script src="js/utils.js"></script>

        <script src="js/Pager.js"></script>
        <link rel="stylesheet" type="text/css" href="css/Pager.css" />

        <script src="js/dragscroll.js"></script>
        <script src="js/geoslicing.js"></script>
        <script src="js/GeoLoadTracker.js"></script>
        <script src="js/MapMarkerManager.js"></script>
        <script src="js/MWaterSqlModel.js"></script>
        <script src="js/MWaterApiModel.js"></script>
        <script src="js/sampleanalysis.js"></script>
        <script src="js/Application.js"></script>
        <script src="js/SyncDb.js"></script>
        <script src="js/SyncServer.js"></script>
        <script src="js/SyncClient.js"></script>
        <script src="js/SourceCodeManager.js"></script>
        <script src="js/ImageManager.js"></script>
        <script src="js/PhotoDisplayer.js"></script>
        <script src="js/ProblemReporter.js"></script>
        <script src="js/SourceMap.js"></script>

        <!-- Load pages -->
        <script src="pages/Login.js"></script>
        <script src="pages/Main.js"></script>
        <script src="pages/Sources.js"></script>
        <script src="pages/Source.js"></script>
        <script src="pages/Map.js"></script>
        <script src="pages/NewSource.js"></script>
        <script src="pages/Tests.js"></script>
        <script src="pages/NewTest.js"></script>
        <script src="pages/Photo.js"></script>
        <script src="pages/Test.js"></script>
        <script src="pages/Test_0.js"></script>
        <script src="pages/Test_1.js"></script>
        <script src="pages/Test_2.js"></script>
        <script src="pages/Test_4.js"></script>
        <script src="pages/SourceNote.js"></script>

        <style>
			html {
				height: 100%
			}
			body {
				height: 100%;
				margin: 0;
				padding: 0
			}
			#map_canvas {
				height: 100%;
				width: 100%;
			}
			#page_container {
				height: 100%;
			}
			#status_control {
				background-color: #C0E0FF;
				font-weight: bold;
				padding: 5px;
				margin-top: 10px;
				border: 1px black solid;
				min-width: 100px;
				text-align: center;
			}
        </style>

        <script>
			var actionbar = {
				menu : function(items, callback) {
					$("#navbar_items").html('');
					_.each(items, function(item) {
						nitem = $('<li><a href="#">' + (item.icon ? '<img height="20" width="20" src="' + item.icon + '">' : '') + item.title + '</a></li>')
						nitem.click(function() {
							callback(item.id);
							return false;
						});

						$("#navbar_items").append(nitem);
					});
				},
				title : function(title) {
					$("#navbar_title").text(title);
				},
				up : function(enabled) {
				}

			};

            var infowindow = new google.maps.InfoWindow({
                    maxWidth : 410});
                    

			function sourceClick(source, marker) {
                var content = $($("#info_window").html());
                
				// Create info window
				var opts = {};
				opts.serverUrl = "/mwater/apiv2/";
				opts.cacheImages = false;
				opts.initialPage = "Source";
				opts.initialPageArgs = [source.uid];
				opts.anchorState = false;
				opts.pageContainer = content.find("#page_container");
				opts.localDb = false;
				var application = new Application(opts);

                infowindow.setContent(content.get(0));

				infowindow.open(sourceMap.gmap, marker);
			}

			var sourceMap;
			$(function() {
				sourceMap = new SourceMap($("#map_canvas").get(0), "/mwater/apiv2/", null, sourceClick);
			});

        </script>

        <script id="info_window" type="text/html">
            <div style="height: 500px; width: 400px; overflow-x:hidden; overflow-y: auto">
            <div class="navbar navbar-inverse">
            <div class="navbar-inner" style="padding-left: 10px;">
            <a class="brand" id="navbar_brand"><span id="navbar_title">mWater</span></a>
            <ul class="nav pull-right" id="navbar_items">
            </ul>
            </div>
            </div>
            <div id="page_container"></div>
            </div>
        </script>
        <script id="desktop_navbar" type="text/html"></script>
    </head>

    <body>
        <div id="map_canvas">

        </div>
    </body>
</html>